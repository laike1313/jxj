<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>物品审批系统流程图</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.2.0/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background-color: #f5f5f5;
            margin: 0;
            padding: 30px;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            text-align: center;
            color: #7B68EE;
            margin-bottom: 30px;
            border-bottom: 2px solid #eee;
            padding-bottom: 15px;
        }
        
        .diagram-container {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            overflow: auto;
        }
        
        .mermaid {
            font-size: 16px;
        }
        
        .description {
            margin-top: 30px;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 8px;
            border-left: 4px solid #7B68EE;
        }
        
        .description h2 {
            color: #7B68EE;
            margin-top: 0;
        }
        
        .description p {
            line-height: 1.6;
        }
        
        .description ul {
            padding-left: 20px;
        }
        
        .description li {
            margin-bottom: 10px;
        }
        
        .save-button {
            display: block;
            background-color: #7B68EE;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            margin: 20px auto;
            transition: background-color 0.3s;
        }
        
        .save-button:hover {
            background-color: #6A5ACD;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>物品审批系统流程图</h1>
        
        <div class="diagram-container">
            <pre class="mermaid">
flowchart TD
    A([开始]) --> B[登录页面]
    B --> C{判断用户角色}
    
    C -->|普通用户| D[用户仪表盘]
    C -->|管理员| L[管理员仪表盘]
    
    D --> E1[查看申请统计]
    D --> E2[查看我的申请]
    D --> F[创建新申请]
    
    F --> G[填写申请表单]
    G --> H[提交申请]
    H --> I[申请已提交]
    I --> J[等待审批结果]
    
    E2 --> K[查看申请状态]
    K --> J
    
    L --> M[查看系统统计]
    L --> N[查看待审批申请]
    N --> O[查看申请详情]
    O --> P{审批决定}
    
    P -->|批准| Q1[批准申请]
    P -->|拒绝| Q2[拒绝申请]
    
    Q1 --> R[更新申请状态]
    Q2 --> R
    R --> S[通知用户]
    S --> T[用户收到结果]
    T --> D
    
    D --> Z[退出登录]
    L --> Z
    Z --> END([结束])
    
    classDef start fill:#7B68EE,stroke:#333,stroke-width:2px,color:white
    classDef userOp fill:#4CAF50,stroke:#333,stroke-width:1px,color:white
    classDef adminOp fill:#9C8AFF,stroke:#333,stroke-width:1px,color:white
    classDef decision fill:#FFC107,stroke:#333,stroke-width:1px
    classDef system fill:#2196F3,stroke:#333,stroke-width:1px,color:white
    classDef end fill:#F44336,stroke:#333,stroke-width:2px,color:white
    
    class A,END start
    class D,E1,E2,F,G,H,I,J,K,T userOp
    class L,M,N,O,Q1,Q2 adminOp
    class C,P decision
    class B,R,S,Z system
            </pre>
        </div>
        
        <button class="save-button" id="saveBtn">保存为图片</button>
        
        <div class="description">
            <h2>流程说明</h2>
            <p>该流程图展示了物品审批系统的完整工作流程，涵盖了从用户登录到申请处理的各个环节。</p>
            
            <h3>主要流程：</h3>
            <ul>
                <li><strong>用户登录</strong>：所有用户通过同一登录页面进入系统</li>
                <li><strong>角色判断</strong>：系统根据用户名判断用户角色（普通用户或管理员）</li>
                <li><strong>普通用户操作</strong>：
                    <ul>
                        <li>查看个人申请统计</li>
                        <li>提交新的物品申请</li>
                        <li>查看申请的审批状态</li>
                    </ul>
                </li>
                <li><strong>管理员操作</strong>：
                    <ul>
                        <li>查看系统整体统计数据</li>
                        <li>处理待审批的申请</li>
                        <li>批准或拒绝用户的申请</li>
                    </ul>
                </li>
                <li><strong>状态更新</strong>：申请状态变更后，系统更新数据并通知用户</li>
                <li><strong>流程终止</strong>：用户通过退出登录离开系统</li>
            </ul>
            
            <h3>流程图颜色说明：</h3>
            <ul>
                <li><span style="color: #7B68EE;">■</span> 紫色：起始/结束节点</li>
                <li><span style="color: #4CAF50;">■</span> 绿色：普通用户操作</li>
                <li><span style="color: #9C8AFF;">■</span> 淡紫色：管理员操作</li>
                <li><span style="color: #FFC107;">■</span> 黄色：决策点</li>
                <li><span style="color: #2196F3;">■</span> 蓝色：系统操作</li>
                <li><span style="color: #F44336;">■</span> 红色：结束节点</li>
            </ul>
        </div>
    </div>
    
    <script>
        // 初始化Mermaid
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            securityLevel: 'loose',
            flowchart: {
                useMaxWidth: false,
                htmlLabels: true,
                curve: 'monotoneX'
            }
        });

        // 等待mermaid渲染完成后再添加保存功能
        document.addEventListener('DOMContentLoaded', function() {
            // 给保存按钮添加点击事件
            document.getElementById('saveBtn').addEventListener('click', function() {
                // 设置延迟，确保流程图已完全渲染
                setTimeout(function() {
                    // 获取SVG元素
                    const svg = document.querySelector('.mermaid svg');
                    
                    if (svg) {
                        try {
                            // 创建一个Canvas元素
                            const canvas = document.createElement('canvas');
                            const ctx = canvas.getContext('2d');
                            
                            // 创建Image对象
                            const img = new Image();
                            
                            // 将SVG转换为数据URL
                            const svgData = new XMLSerializer().serializeToString(svg);
                            const svgBlob = new Blob([svgData], {type: 'image/svg+xml;charset=utf-8'});
                            const url = URL.createObjectURL(svgBlob);
                            
                            // 当图像加载完成后绘制到Canvas上
                            img.onload = function() {
                                // 设置Canvas尺寸
                                canvas.width = img.width;
                                canvas.height = img.height;
                                
                                // 绘制图像
                                ctx.fillStyle = 'white';
                                ctx.fillRect(0, 0, canvas.width, canvas.height);
                                ctx.drawImage(img, 0, 0);
                                
                                // 转换为PNG
                                try {
                                    const pngUrl = canvas.toDataURL('image/png');
                                    
                                    // 创建下载链接
                                    const downloadLink = document.createElement('a');
                                    downloadLink.download = '物品审批系统流程图.png';
                                    downloadLink.href = pngUrl;
                                    downloadLink.click();
                                    
                                    // 释放URL对象
                                    URL.revokeObjectURL(url);
                                } catch (e) {
                                    alert('保存失败，可能是由于浏览器安全限制。请尝试截图保存。');
                                    console.error(e);
                                }
                            };
                            
                            // 设置图像源
                            img.src = url;
                        } catch (e) {
                            alert('保存失败，请尝试使用浏览器的截图功能保存图片。');
                            console.error(e);
                        }
                    } else {
                        alert('图表尚未完全加载，请稍后再试');
                    }
                }, 1000); // 1秒延迟，确保图表渲染完成
            });
        });
    </script>
</body>
</html> 